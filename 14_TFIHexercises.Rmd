
# TFIH Exercises

Below you will find Exercises relevant for the data analysis for the project work in the Thematic course in Food Innovation and Health. Exercises are meant as a guide on what to do woth your own data in the end. 

Before you start to work on the Exercises, you need to familiarize yourself with the knowledge in the introduction chapters of this book as well as the chapters written specifically of for this course. 

[RET IND: We use the XXXXX data]

## Exercise 1: Descriptive statistics and plots

[create data set with CATA counts + make table thereof]
[plot hedonic ratings per product in histograms to see the dustribution in each category]
[calculate mean and standard deviation on hedonic ratings + histogram]


## Exercise 2: PCA on consumer background

From this exercise you should be able to describe who your consumers are.

Make the data available: 

```{r}
library(data4consumerscience)
data("beerdemo")
```

Calculate a PCA model including the Variables 7 ( _Interest in food_ ) to 12 ( _`Future interest in beer`_ ). Remember to standardize/scale the variables

```{r}
mdlPCA <- prcomp(beerdemo[,7:12],scale. = T)
```

Plot the scores and loadings in a biplot and look for groupings of the consumers in the scores. 

Group and color according to the background information not used in the model (Gender, Age,..)

```{r}
library(ggbiplot)
ggbiplot(mdlPCA, groups = beerdemo$Gender, ellipse = T)
```

Describe what you find.

## Exercise 3: PCA on CATA counts

From this exercise you should be able to describe your samples (beers) from the CATA counts. Collated (summed) for each beer of CATA score from all consumers.

[SPØRGSMÅL: blev vi ikke enige om på mødet 7/10 at det skulle være på rådata?]

Setup the collated version as described above. 

```{r, eval=FALSE}
beercatasum <- beercata %>% 
  gather(attrib, ...
```

Calculate a PCA model including all Variables and all Objects.

```{r, eval=FALSE}
PCAmdl <- prcomp(beercatasum, scale. = T)
```

Plot the scores and describe the groupings of the samples.
Plot the loadings and describe the correlations between the variables.

```{r, eval=FALSE}
ggbiplot(PCAmdl)
```

Use this biplot to find out which samples are described by which words. 



## Exercise 4: Cochran’s Q test on CATA binary data

Dataset: Beer_XYZmatrix.xlsx, sheet “X unfolded”

Import the datasheet in to R Studio using the CSV format (save the file as CSV in Excel). 
Choose 4 relevant CATA attributes (based on your previous results today) to make a Cochran’s Q test and the Post hoc test, comment on the results (i.e. the sample differences). 


```{r}

```



## Exercise 5: PCA on hedonic ratings

From this exercise you should be able to describe the liking of the beer samples and see how the consumers do this. 

Calculate a PCA model including all Variables and all Objects.

```{r, eval=FALSE}
include_these <- complete.cases(beerliking)
PCAliking <- prcomp(beerliking[include_these,-1], scale. = T)
```

Plot a biplot or loading plot, and use the loadings and describe the correlations between the variables (liking of beers in this case).

```{r, eval=FALSE}
ggbiplot(PCAliking)
```


Plot the scores and describe the groupings of the samples by colouring the score plot according to the consumer background variables. Note that the 160 rows in both datasets match each-other, so we can glue the demo information directly onto the liking model. If that was not the case, matching using left_join() or inner_join() would be nessesary before analysis.

```{r, eval=FALSE}
ggbiplot(PCAliking,groups = beerdemo$Age[include_these], ellipse = T)
```


Any trends? For instance, how is liking related to the individual consumer diversity of beer (_Beer types/month_)? 

... Some code to get all 7-scale demo information plots. You may want to export and view in a pdf viewer for zooming etc.  

```{r, eval=FALSE}
gall <- cbind(PCAliking$x[,1:2], beerdemo[include_these,]) %>% 
  gather(var,val,`Interest in food`:App_Vinous) %>% 
  ggplot(data = ., aes(PC1,PC2, color = factor(val))) + 
  geom_point() + 
  stat_ellipse() + 
  facet_wrap(~var)
ggsave(filename = 'anicebigfigure.pdf',gall, height = 20, width = 20)
```


## Exercise 6: PCA on CATA counts and hedonic ratings


[LAVES OM til PCA, nyt plot laves, da liking ikke er med nedenfor lige nu]


From this exercise you should be able to conclude what drives the liking of your samples (beers).

For each beer, the collated CATA counts is the predictors, and the averaged liking is the response.

```{r, eval = F}
likingsum <- beerliking %>% 
  gather(Beer, liking, -`Consumer ID`) %>% 
  group_by(Beer) %>% 
  dplyr::summarise(lik = mean(liking, na.rm = T))
```

Check that the rows are ordered in the same way: 

```{r, eval = F}
likingsum$beer
beercatasum$Beer
CATAlik <- list()
CATAlik$CATA <- scale(as.matrix(beercatasum[,-1]))
CATAlik$lik <- scale(likingsum$lik)
rownames(CATAlik$lik) <- rownames(CATAlik$CATA) <- beercatasum$Beer

```


Calculate a PLS model where CATA features are predictors and liking is response for all Objects. 

```{r, eval = F}
library(pls)
catalik.pls <- plsr(lik ~ CATA, ncomp = 2, data = CATAlik, validation = "LOO")
corrplot(catalik.pls, labels = colnames(beercatasum)[-1])


biplot(catalik.pls)
```


Plot the loadings and study which X variables are important for the liking score.
Advanced: Plot the Regression coefficients (scaled) and try to interpret the meaning of this plot (Hint: use your findings from the loadings plot).
 


## Exercise 7: Mixed modelling on hedonic ratings

[MANGLER HELT]

### simple



### multifactorial 

Dataset: Beer_XYZmatrix.xlsx, sheet “Z and Y liking”
Import the datasheet in to R Studio. 
Check to see if all variables have the correct description/denomination (factor, numerical etc.)
Are there any significant product differences for the liking? If so, what does the Tukey tell us? How does this fit with what you have done in the PCA/PLS exercises. 
Is the liking in general affected by the age, gender, household size or beer knowledge? What is the effect? Try to think of a plot that can show the significant differences.
Do men and women score the samples significantly different in liking? Calculate the sample/gender differences in averages, try to use Pivot Tables in Excel.

